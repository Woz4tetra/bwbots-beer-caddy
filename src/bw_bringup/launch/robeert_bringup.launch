<?xml version="1.0" encoding="UTF-8"?>
<launch>
    <arg name="map_name" default="$(env ROS_MAP_NAME)"/>
    <arg name="robot_name" default="$(env ROBOT)"/>

    <include file="$(find bw_description)/launch/bw_description.launch">
        <arg name="model" value="$(find bw_description)/urdf/$(arg robot_name).urdf.xml"/>
        <arg name="joint_names" value="$(find bw_bringup)/config/$(arg robot_name)/joints.yaml"/>
    </include>
    <include file="$(find bw_bringup)/config/$(arg robot_name)/static_transforms_$(arg robot_name).launch"/>
    <include file="$(find bw_description)/launch/imu_joint.launch">
        <arg name="combine_with_odom" value="true"/>
    </include>

    <include file="$(find bw_tunnel)/launch/bw_tunnel.launch">
        <arg name="publish_odom_tf" value="false"/>
        <arg name="robot_address" value="/dev/serial/by-id/usb-Teensyduino_USB_Serial_12396120-if00"/>
        <arg name="joint_names" value="$(find bw_bringup)/config/$(arg robot_name)/joints.yaml"/>
    </include>
    <include file="$(find bw_tunnel)/launch/twist_mux.launch"/>

    <include file="$(find bw_load_cell)/launch/bw_load_cell.launch">
        <arg name="device_path" default="/dev/serial/by-id/usb-Silicon_Labs_CP2104_USB_to_UART_Bridge_Controller_018D31F7-if00-port0"/>
        <arg name="calibration_value" default="-33393.6015625"/>
    </include>

    <group ns="laser">
        <include file="$(find bw_rplidar)/launch/bw_rplidar_s1.launch">
            <arg name="serial_port" value="/dev/serial/by-id/usb-Silicon_Labs_CP2102_USB_to_UART_Bridge_Controller_0001-if00-port0"/>
            <arg name="lidar_node_name" value="$(arg robot_name)_rplidar"/>
            <arg name="laser_frame_id" value="laser"/>
        </include>

        <node pkg="laser_filters" type="scan_to_scan_filter_chain" name="laser_filter">
            <rosparam command="load" file="$(find bw_bringup)/config/$(arg robot_name)/laser_filter.yaml" />
        </node>
    </group>

    <include file="$(find bw_move_base)/launch/bw_move_base.launch"/>
    <include file="$(find bw_behaviors)/launch/bw_behaviors.launch"/>
    <include file="$(find bw_zed)/launch/bw_zed.launch"/>

    <include file="$(find bw_waypoints)/launch/bw_waypoints.launch">
        <arg name="waypoints_path" value="$(find bw_data)/waypoints/$(env ROS_MAP_NAME)"/>
    </include>

    <include file="$(find bw_yolo)/launch/label_publisher.launch"/>
    <include file="$(find bw_dispensers)/launch/bw_dispensers.launch"/>

    <include file="$(find bw_laser_slam)/launch/bw_laser_slam.launch">
        <arg name="mode" value="localize"/>
        <arg name="map_name" value="$(arg map_name)"/>
    </include>
    <include file="$(find bw_localization)/launch/bw_localization.launch"/>
</launch>
